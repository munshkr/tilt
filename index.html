<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width" />
  <title>zxc</title>
</head>

<body>

<h1>zxc</h1>
<input id="formula" size="80" type="text"
  value="( ((t<<1)^((t<<1)+(t>>7)&t>>12))|t>>(4-(1^7&(t>>19)))|t>>7 ) %64/64"
  onKeyUp="reformulate(this.value)">
<button id="play" onclick="playResume()">Play</button>

<script type="text/javascript">

var SAMPLES = 4096;
var GAIN = 0.25;

var audioCtx = null;
var oscillator = null;
var started = false;

var t = 0;

var generator = function(t) { return t; }

function reformulate(v) {
  try {
    var t = 0;
    var s = Math.sin;
    var x = Math.random;
    eval(v);
    var e = "generator = function (t) { var s = Math.sin; var x = Math.random(); return " + v + "; }";
    console.log(e);
    eval(e);
    document.getElementById('formula').setAttribute('class', '');
  } catch (e) {
    console.log(e);
    document.getElementById('formula').setAttribute('class', 'err');
  }
}

function playResume() {
  var btn = document.getElementById("play");
  if (!started) {
    btn.textContent = "Stop";
    start();
  } else {
    btn.textContent = "Play";
    stop();
  }
}

function createNode() {
  var node = audioCtx.createScriptProcessor(0, 0, 2);
  console.log("Buffer size: " + node.bufferSize);

  node.onaudioprocess = function(audioProcessingEvent) {
    var outputBuffer = audioProcessingEvent.outputBuffer;

    for (var sample = 0; sample < node.bufferSize; sample++) {
      for (var channel = 0; channel < outputBuffer.numberOfChannels; channel++) {
        var outputData = outputBuffer.getChannelData(channel);
        outputData[sample] = GAIN * generator(t / 16);
      }
      t++;
    }
    //console.log(t)
  }

  node.connect(audioCtx.destination);
  return node;
}

function stop() {
  node.disconnect(audioCtx.destination);
  node = null;
  started = false;
}

function start() {
  if (!audioCtx) {
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  }
  var formula = document.getElementById('formula').value;
  reformulate(formula);
  node = createNode();
  started = true;
}

</script>

</body>
</html>
